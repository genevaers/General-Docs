# RED file overview {#SACRED .concept}

## 01 Summary of this topic {#01 .section}

The sections in this topic are as follows:

-   [10 What is a RED file?](SACRED.md#10)
-   [20 Example of two-step lookup using two RED files](SACRED.md#20)
-   [25 Example of two-step lookup using one RED file](SACRED.md#25)
-   [30 How is a RED file created?](SACRED.md#30)
-   [40 Processing for RED files](SACRED.md#40)
-   [50 Numbering and JCL for RED files](SACRED.md#50)
-   [60 Actual number of RED files for a run of PE](SACRED.md#60)
-   [100 Need more on this page?](SACRED.md#100)

## 10 What is a RED file? {#10 .section}

RED file = **REference Detail file**.

A RED file is a file generated by SAFR to ensure fast processing for a step in a lookup path.

This topic assumes you are familiar with topic "**Lookup path overview**". A link to that overview is under **Related concepts** below.

A RED file contains the minimum requirements for a single step in a lookup path:

-   The primary key for the target logical record.
-   The lookup field in the target logical record.
-   IBM proprietary data that ensures the lookup is processed as fast as possible.

The RED file data is stored in memory. Once the RED file is created, lookup path processing does not need slow input/output operations for the reference files.

If a lookup path has two steps, how many RED files are required?

-   Sometimes two RED files, see section [20 Example of two-step lookup using two RED files](SACRED.md#20).
-   Sometimes one RED file, see section [25 Example of two-step lookup using one RED file](SACRED.md#25).

RED files are used as follows:

-   In the extract phase, **MR95** processes each step in a lookup path using a relevant RED file.
-   In the format phase, **MR88** processes each step in a lookup path \(for a Sort Key Title\) using a relevant RED file.

How do MR95 and MR88 know which is the relevant RED file for each step?

-   The **REH file** lists the relevant RED files in the extract phase.

    An REH file effectively links a lookup path step in the extract phase to a particular RED file.

    For more, see topic "**REH file overview**". A link to that overview is under **Related concepts** below.

-   The **RTH file** lists the relevant RED files in the format phase.

    An RTH file effectively links a lookup path step in the format phase to a particular RED file.

    For more, see topic "**RTH file overview**". A link to that overview is under **Related concepts** below.


The REH file is stored in memory for MR95. The RTH file is stored in memory for MR88. The REH, RTH and RED files ensure lookup paths one of the fastest and most powerful features of SAFR.

For details of how the REH file, RTH file and RED files are created, see section [10 What is a RED file?](SACRED.md#10).

For naming of RED files, see section [50 Numbering and JCL for RED files](SACRED.md#50).

## 20 Example of two-step lookup using two RED files {#20 .section}

In this example, call the lookup path **LP\_SalesProdCateg**.

The **steps** are as follows:

1.  Use **SLR\_Prod\_code** to access the **Prod\_LR** logical record.
2.  Use **PLR\_Categ\_code** to access the **Categ\_LR** logical record.

![](images/LP_Steps_02.gif)

For the above lookup path, the two steps have different target logical records. This means that two RED files are required:

1.  Step 1 requires a RED file to access logical record PROD\_LR
2.  Step 2 requires a RED file to access logical record Categ\_LR

## 25 Example of two-step lookup using one RED file {#25 .section}

In this example, call the lookup path **LP\_Manager\_Of\_Manager**.

This lookup starts with an given employee and finds the employee ID for the manager of the manager of that given employee.

The **steps** are as follows:

1.  Use **ELR\_Mgr\_Emp\_ID** in the employee record to access an **Employee\_LR** logical record.
2.  Use **ELR\_Mgr\_Emp\_ID** from the new record found to access another **Employee\_LR** logical record.

![](images/LP_Steps_04_OneRED.gif)

For the above lookup path, the two steps have the same target logical record and the same lookup field. This means that only one RED files is required:

1.  Steps 1 and 2 require the same RED file to access logical record Employee\_LR to obtain field ELR\_Mgr\_Emp\_ID.

## 30 How is a RED file created? {#30 .section}

RED files \(and the REH file and the RTH file\) are created by **MR95 in the reference phase**.

MR95 in the reference phase achieves this by using instructions in the JLT file. The JLT instructions were created by **MR90** in the logic phase. The description of how RED files are created requires knowledge of both MR90 and MR95.

The role of MR90 in lookup processing is to plan and coordinate the RED files along with the REH file and the RTF file.

MR90 achieves this by generating new views that are completely different to the views that you specify in the select phase. These generated views are stored in the JLT.

**MR90** performs the following:

-   Analyzes the lookup paths in views you specified in the select phase and determines how many RED files are needed for each lookup path. Checks if different lookup paths can share the same RED file\(s\).Determines the list of RED files necessary for this run of PE.
-   Generates a new view for each RED file necessary. Each new view is stored in the JLT file and has a number different from any view number you specified in the select phase.
-   Generates a single new view for the REH file if any RED files are used in the extract phase. That new view is stored in the JLT file and has a number different from any view number you specified in the select phase.
-   Generates a single new view for the RTH file if any RED files are used in the format phase for Sort Key Titles. That new view is stored in the JLT file and has a number different from any view number you specified in the select phase.

Each of the new views generated contains logic table instructions for creating the appropriate file \(RED, REH or RTH\).

**MR95 in the reference phase** performs the following:

-   Reads the JLT file containing the new views generated by MR90 \(if the JLT is not empty\).
-   Executes each new view. Collectively these new views create the RED files, and the REH file and the RTH file. It is possible that there is only one RED file and that the REH or RTH file may not be necessary.
-   Outputs the created files. These files are used in the extract and format phases.

For more on MR90, MR95, and the JLT, see these topics:

-   "**JLT file overview**"
-   "**Logic phase overview**"
-   "**MR90 Logic Table Generator overview**"
-   "**MR95 Reference and Extract overview**"

Links to these overviews are under **Related concepts** below.

## 40 Processing for RED files {#40 .section}

![](images/RED_Phases_01.gif)

Processing of RED files is the same as the processing of lookup paths:

1.  The **Join Logic Table \(JLT\)** is created in program **MR90** in the **logic** phase. The JLT includes commands for any lookup paths in the view\(s\) selected for this run of PE. If the view\(s\) contain no lookup paths, then the JLT is empty.

    For more, see these topics:

    -   "**JLT file overview**"
    -   "**Logic phase overview**"
    -   "**MR90 Logic Table Generator overview**"
    Links to these overviews are under **Related concepts** below.

2.  The **JLT** is converted into EBCDIC format in program **MR76** in the **logic** phase. This conversion covers the commands for lookup paths that are stored in the JLT.

    For more, see these topics:

    -   "**JLT file overview**"
    -   "**Logic phase overview**"
    -   "**MR76 LT to EBCDIC overview**"
    Links to these overviews are under **Related concepts** below.

3.  A report on the **JLT** is created by program **UT90** in the **reference** phase. This report shows the lookup paths contained in the JLT.

    For more, see these topics:

    -   "**JLT file overview**"
    -   "**Reference phase overview**"
    -   "**UT90 Logic Table Report overview**"
    Links to these overviews are under **Related concepts** below.

4.  Program **MR95** creates the **Reference Detail \(RED\)** and **Reference Header \(REH\)** files in the **reference** phase. The RED and REH files are essential for processing lookup paths in the extract phase later. The RED files are used for lookups in the format phase later.

    For more, see these topics:

    -   "**Reference phase overview**"
    -   "**REH file overview**"
    -   "**MR95 Reference and Extract overview**"
    Links to these overviews are under **Related concepts** below.

5.  Program **MR95** executes the lookups contained in the JLT using the RED and REH files. MR95 in this case runs in the **extract** phase. Lookup paths get processed very fast in this phase and the format phase.

    For more, see these topics:

    -   "**Extract phase overview**"
    -   "**REH file overview**"
    -   "**MR95 Reference and Extract overview**"
    Links to these overviews are under **Related concepts** below.

6.  Program **MR88** uses the RED files for lookups for the Sort Key Titles in the **format** phase. 

    For more, see these topics:

    -   "**Format phase overview**"
    -   "**MR88 Format Data overview**"
    Links to these overviews are under **Related concepts** below.


Links to the runbooks for the programs mentioned above are under "**Related Reference**" below.

## 50 Numbering and JCL for RED files {#50 .section}

RED files are numbered using DDNAMES with this pattern: **GREF999** where:

-   **G** stands for "Geneva". Geneva is an historical name for SAFR.
-   **REF** stands for Reference, and means a reference file that is the target logical file of a step in a lookup path.
-   **999** is a three digit number between 003 and 999 inclusive.

    The reason that 003 is the first RED file is because historically RED file 001 and 002 were not the same as the other RED files. RED file 001 is now called the REH file RED file 002 is now called the RTH file. RED files 001 and 002 are no longer used, and the RED and RTH files are used instead.

    This means there are at most 997 RED files in one run of PE.


Sample JCL in **MR95 in the reference phase** is below:

|```
//GREF003  DD DSN=&HIUPN..FILE003.RED,
//            DISP=(NEW,CATLG,DELETE),
//            UNIT=(&UNIT.,10),
//            SPACE=(TRK,(1,1000),RLSE),
//            DCB=(DSORG=PS,RECFM=VB,LRECL=4144)
//*                                             
//GREF004  DD DSN=&HIUPN..FILE004.RED,
//            DISP=(NEW,CATLG,DELETE),
//            UNIT=(&UNIT.,10),
//            SPACE=(TRK,(1,1000),RLSE),
//            DCB=(DSORG=PS,RECFM=VB,LRECL=4144)
```

|

The above JCL shows that the RED files are**RECFM=VB** \(Variable Blocked\). The **LRECL** represents the maximum record length, and **4144** should always be used for RED files. The value of 4144 is based on program that creates the RED files: MR95 in the reference phase. The record length varies for different RED files depending on the lookup step, so the above JCL works for any RED file.

Sample JCL in **MR95 in the extract phase** is below:

|```
//GREF003  DD DISP=SHR,DSN=&HISPN..FILE003.RED
//GREF004  DD DISP=SHR,DSN=&HISPN..FILE004.RED
```

|

Sample JCL in **MR88 \(in the format phase\)** is below:

|```
//GREF003  DD DISP=SHR,DSN=&HISPN..FILE003.RED
//GREF004  DD DISP=SHR,DSN=&HISPN..FILE004.RED 
```

|

## 60 Actual number of RED files for a run of PE {#60 .section}

The maximum number of RED files is **997** = 999 - 2 \(see the previous section for the reason for this number\).

The actual number of RED files for a run of PE depends on how many RED files are created by MR95 in the reference phase, and that depends on the lookup steps for the views selected.

RED files are potentially needed in the extract and format phases.

The **actual number of RED files for the extract phase** is found as follows:

1.  Ensure the reference phase runs **MR71 for the REH file** \(if the REH file is created for that run of PE\).
2.  Check the MR71 Report for the REH file. The column "**EXTR FILE\#**" is the number of a particular RED file, which is between 3 and 999 inclusive.
3.  The number of RED files created for the extract phase is the number of rows in the report.

The **actual number of RED files for the format phase** is found as follows:

1.  Ensure the reference phase runs **MR71 for the RTH file** \(if the RTH file is created for that run of PE\).
2.  Check the MR71 Report for the RTH file. The column "**EXTR FILE\#**" is the number of a particular RED file, which is between 3 and 999 inclusive.
3.  The number of RED files created for the format phase is the number of rows in the report.

## 100 Need more on this page? {#100 .section}

If you need more details to be added to this page, please email **AskSAFR@us.ibm.com** .

**Parent topic:**[SAFR overviews](../html/AAR450Overviews.md)

